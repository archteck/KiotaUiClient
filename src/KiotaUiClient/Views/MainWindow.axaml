<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:KiotaUiClient.ViewModels"
        x:Class="KiotaUiClient.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Width="800" Height="780"
        MinWidth="800" MinHeight="780"
        WindowStartupLocation="CenterScreen"
        Title="Kiota Client Generator">

    <Design.DataContext>
        <vm:MainWindowViewModel />
    </Design.DataContext>

    <Window.Styles>
        <Style Selector="TextBlock.Header">
            <Setter Property="FontSize" Value="14" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Margin" Value="0,0,0,5" />
        </Style>
        <Style Selector="TextBox">
            <Setter Property="Margin" Value="0,0,0,10" />
        </Style>
        <Style Selector="ComboBox">
            <Setter Property="Margin" Value="0,0,0,10" />
            <Setter Property="HorizontalAlignment" Value="Stretch" />
        </Style>
        <Style Selector="Button">
            <Setter Property="Padding" Value="15,8" />
        </Style>
    </Window.Styles>

    <DockPanel>
        <!-- Menu -->
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="_File">
                <MenuItem Header="_Generate" Command="{Binding GenerateClientCommand}" HotKey="Ctrl+G">
                    <MenuItem.Icon><PathIcon Data="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z" /></MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="_Update" Command="{Binding UpdateClientCommand}" HotKey="Ctrl+U">
                    <MenuItem.Icon><PathIcon Data="M21,10.12H14.22L16.96,7.3C14.23,4.6 9.81,4.5 7.08,7.2C4.35,9.91 4.35,14.28 7.08,17C9.81,19.7 14.23,19.7 16.96,17C18.32,15.65 19,14.08 19,12.1H21C21,14.08 20.12,16.65 18.36,18.39C14.85,21.87 9.15,21.87 5.64,18.39C2.14,14.92 2.11,9.28 5.62,5.81C9.13,2.34 14.76,2.34 18.27,5.81L21,3V10.12M12.5,8V12.25L16,14.33L15.28,15.54L11,13V8H12.5Z" /></MenuItem.Icon>
                </MenuItem>
                <Separator />
                <MenuItem Header="E_xit" HotKey="Alt+F4" Click="Exit_OnClick">
                    <MenuItem.Icon><PathIcon Data="M19,3H5C3.89,3 3,3.89 3,5V9H5V5H19V19H5V15H3V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M10.08,15.58L11.5,17L16.5,12L11.5,7L10.08,8.41L12.67,11H3V13H12.67L10.08,15.58Z" /></MenuItem.Icon>
                </MenuItem>
            </MenuItem>
        </Menu>

        <Grid Margin="15">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="400" MinWidth="350" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" MinWidth="300" />
            </Grid.ColumnDefinitions>

            <!-- Config Panel -->
            <ScrollViewer Grid.Column="0">
                <StackPanel Spacing="5" Margin="0,0,10,0">
                    <TextBlock Text="Source Type" Classes="Header" />
                    <StackPanel Orientation="Horizontal" Spacing="15" Margin="0,0,0,10">
                        <RadioButton Content="URL" IsChecked="{Binding !IsFileMode}" />
                        <RadioButton Content="File" IsChecked="{Binding IsFileMode}" />
                    </StackPanel>

                    <TextBlock Text="OpenAPI URL/File" Classes="Header" />
                    <Grid ColumnDefinitions="*, Auto">
                        <TextBox Text="{Binding Url}" Watermark="URL or Path to OpenAPI spec" Grid.Column="0" />
                        <Button Content="..." Command="{Binding BrowseOpenApiFileCommand}" 
                                IsVisible="{Binding IsFileMode}" Grid.Column="1" VerticalAlignment="Top" Margin="5,0,0,0"/>
                    </Grid>

                    <TextBlock Text="Project Details" Classes="Header" Margin="0,10,0,5" />
                    <TextBlock Text="Namespace" FontSize="12" />
                    <TextBox Text="{Binding Namespace}" Watermark="e.g. MyProject.Client" />
                    
                    <TextBlock Text="API Client Name" FontSize="12" />
                    <TextBox Text="{Binding ClientName}" Watermark="e.g. MyApiClient" />

                    <Grid ColumnDefinitions="*, *">
                        <StackPanel Grid.Column="0" Margin="0,0,5,0">
                            <TextBlock Text="Language" Classes="Header" />
                            <ComboBox ItemsSource="{Binding Languages}" SelectedItem="{Binding Language}" />
                        </StackPanel>
                        <StackPanel Grid.Column="1" Margin="5,0,0,0" IsVisible="{Binding IsAccessModifierVisible}">
                            <TextBlock Text="Access" Classes="Header" />
                            <ComboBox ItemsSource="{Binding AccessModifiers}" SelectedItem="{Binding AccessModifier}" />
                        </StackPanel>
                    </Grid>

                    <TextBlock Text="Destination Folder" Classes="Header" />
                    <Grid ColumnDefinitions="*, Auto">
                        <TextBox Text="{Binding DestinationFolder}" IsReadOnly="True" Grid.Column="0" />
                        <Button Content="Browse" Command="{Binding BrowseFolderCommand}" Grid.Column="1" VerticalAlignment="Top" Margin="5,0,0,0"/>
                    </Grid>

                    <StackPanel Spacing="10" Margin="0,15,0,0">
                        <Button Content="Generate Client" Command="{Binding GenerateClientCommand}" 
                                IsEnabled="{Binding IsGeneratorButtonEnabled}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Center"/>
                        <Grid ColumnDefinitions="*, *">
                            <Button Content="Update Client" Command="{Binding UpdateClientCommand}" 
                                    IsEnabled="{Binding IsUpdateButtonEnabled}" Grid.Column="0" Margin="0,0,5,0" HorizontalAlignment="Stretch" HorizontalContentAlignment="Center"/>
                            <Button Content="Refresh Client" Command="{Binding RefreshClientCommand}" 
                                    IsEnabled="{Binding IsRefreshButtonEnabled}" Grid.Column="1" Margin="5,0,0,0" HorizontalAlignment="Stretch" HorizontalContentAlignment="Center"/>
                        </Grid>
                    </StackPanel>

                    <!-- Application Updater -->
                    <Border Margin="0,20,0,0" Padding="12" BorderBrush="{DynamicResource SystemAccentColor}" BorderThickness="1" CornerRadius="8">
                        <StackPanel Spacing="8">
                            <TextBlock Text="Application Updates" Classes="Header" />
                            <Grid ColumnDefinitions="*, *">
                                <Button Content="Check Updates" Command="{Binding CheckForAppUpdateCommand}" Grid.Column="0" Margin="0,0,5,0" HorizontalAlignment="Stretch" HorizontalContentAlignment="Center"/>
                                <Button Content="Update &amp; Relaunch" Command="{Binding DownloadAndRunUpdateCommand}" 
                                        IsEnabled="{Binding CanDownloadAppUpdate}" Grid.Column="1" Margin="5,0,0,0" HorizontalAlignment="Stretch" HorizontalContentAlignment="Center"/>
                            </Grid>
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <TextBlock Text="Latest Version:" VerticalAlignment="Center" FontSize="12"/>
                                <TextBlock Text="{Binding LatestVersion}" FontWeight="Bold" VerticalAlignment="Center"/>
                            </StackPanel>
                            <ProgressBar Minimum="0" Maximum="1" Value="{Binding DownloadProgress}" Height="10" />
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>

            <GridSplitter Grid.Column="1" Width="4" Margin="5,0" Background="Transparent" />

            <!-- Logs Panel -->
            <DockPanel Grid.Column="2">
                <TextBlock Text="Output Logs" Classes="Header" DockPanel.Dock="Top" />
                <Border BorderBrush="#555" BorderThickness="1" CornerRadius="4" Background="{DynamicResource SystemControlBackgroundAltHighBrush}">
                    <ScrollViewer x:Name="LogScrollViewer" VerticalScrollBarVisibility="Auto">
                        <TextBox Text="{Binding StatusText}"
                                 AcceptsReturn="True"
                                 IsReadOnly="True"
                                 TextWrapping="Wrap"
                                 BorderThickness="0"
                                 Background="Transparent"
                                 FontFamily="Cascadia Code,Consolas,Monospace" />
                    </ScrollViewer>
                </Border>
            </DockPanel>
        </Grid>
    </DockPanel>
</Window>